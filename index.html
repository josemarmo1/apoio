<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Profª Julia Maria</title>
<meta name="description" content="Jogos pedagógicos — 5º ano — aprender se divertindo." />

<!-- FONTS -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;800;900&family=Nunito:wght@400;700;800;900&display=swap" rel="stylesheet">

<!-- FAVICON -->
<link rel="icon" type="image/png" href="imagens/ChatGPT Image 15 de set. de 2025, 13_51_15.png" />
<link rel="apple-touch-icon" href="imagens/ChatGPT Image 15 de set. de 2025, 13_51_15.png" />

<style>
  :root{
    --pink-50:#fff1f6; --pink-100:#ffd9e8; --pink-200:#ffe6f1;
    --pink-400:#ff80ae; --pink-500:#ff5c96;
    --mint-100:#e9fff7; --slate-900:#141922; --slate-700:#273043; --slate-500:#61708d;
    --green:#34c38f; --yellow:#f1c232; --red:#ef6464; --blue:#5a8bff;
    --radius:18px; --shadow:0 18px 40px rgba(20,25,34,.08); --space:clamp(14px,3vw,28px);
    --safe-top: env(safe-area-inset-top, 0px);
    /* <<< largura menor da barra no mobile >>> */
    --search-mobile-max: 200px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:'Nunito',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
    background:linear-gradient(180deg,var(--pink-50),#fff); color:var(--slate-700);
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }
  body.immersive{overflow:hidden}

  /* ===== Topbar ===== */
  .topbar{
    position:sticky; top:0; z-index:50;
    background:rgba(255,255,255,.9);
    -webkit-backdrop-filter:blur(10px); backdrop-filter:blur(10px);
    border-bottom:1px solid #ffe1ef;
    padding-top:calc(var(--safe-top) * 1);
  }
  .nav{
    max-width:1200px; margin:0 auto; padding:10px var(--space);
    /* >>> GRID para centralizar a busca entre logo e menu <<< */
    display:grid; align-items:center; gap:12px;
    grid-template-columns: 1fr auto 1fr; /* esquerda | centro | direita */
  }

  /* Logo maior – sem caixa e sem sobreposição */
  .brand{display:flex; align-items:center; justify-self:start}
  .brand img{
    width:150px; height:150px; object-fit:contain; display:block;
    background:transparent; border-radius:0; box-shadow:none;
    filter:drop-shadow(0 2px 6px rgba(0,0,0,.08)) saturate(1.04) contrast(1.03);
    image-rendering:-webkit-optimize-contrast;
    -webkit-user-select:none; user-select:none; touch-action:manipulation;
  }

  /* Busca menor — e centralizada */
  .search{
    /* em grid, não precisamos de flex-grow; usamos largura máxima e centralizamos */
    justify-self:center;
    width:100%; max-width:480px; /* limite em desktop */
    display:flex; align-items:center; gap:10px;
    padding:10px 12px; border-radius:999px; border:1px solid #ffe1ef; background:#fff;
    min-height:44px;
  }
  .search .glass{font-size:18px; line-height:1}
  .search input{
    border:none; outline:none; font-size:1rem; flex:1 1 auto;
    -webkit-appearance:none; background:transparent;
  }

  /* Botão menu sempre na direita */
  .menu-btn{
    justify-self:end;
    display:flex; align-items:center; justify-content:center;
    width:44px; height:44px; border-radius:12px; border:1px solid #ffd7e7;
    background:#fff; cursor:pointer; font-size:20px; font-weight:900;
  }

  /* MOBILE */
  @media (max-width:600px){
    .nav{ gap:10px; grid-template-columns: auto 1fr auto; }
    .brand img{ width:120px; height:120px; }     /* logo maior no mobile (de 88 -> 120) */
    .search{
      padding:6px 10px; min-height:38px; gap:8px;
      max-width:var(--search-mobile-max);      /* <<< largura da barra no mobile: 200px */
      width:100%;
      justify-self:center;                     /* garante centralização no grid */
      margin:0;                                /* sem empurrar pros lados */
    }
    .search input{ font-size:.95rem; }
    .menu-btn{ width:40px; height:40px; }
  }

  /* Drawer filtros (mobile) */
  .drawer{
    position:fixed; inset:auto 0 0 0;
    background:#fff; border-top-left-radius:18px; border-top-right-radius:18px;
    box-shadow:0 -14px 40px rgba(16,16,24,.16);
    transform:translateY(110%); transition:transform .25s ease;
    z-index:60; padding:14px var(--space) max(16px,calc(env(safe-area-inset-bottom,0px) + 10px));
  }
  .drawer.open{ transform:translateY(0); }
  .drawer .drag{ width:46px; height:5px; border-radius:999px; background:#e9e9ee; margin:0 auto 10px; }
  .drawer h3{ margin:0 0 12px; font-family:'Poppins',sans-serif; font-weight:900; color:#141922; font-size:1.05rem }
  .drawer .row{ display:flex; gap:10px; flex-wrap:wrap }
  .select{
    border:1px solid #ffe1ef; background:#fff; border-radius:999px; padding:10px 12px;
    font-weight:800; color:#7a3e53; min-height:40px;
  }
  .overlay{
    position:fixed; inset:0; background:rgba(0,0,0,.38); z-index:55; opacity:0; pointer-events:none; transition:opacity .2s ease;
  }
  .overlay.show{ opacity:1; pointer-events:auto; }

  /* ===== Hero com faixa animada ===== */
  .hero{position:relative; overflow:hidden; background:linear-gradient(180deg,#ffe9f2,var(--mint-100));}
  .hero .wrap{
    max-width:1200px; margin:0 auto; padding:20px var(--space) 10px; display:grid; gap:12px;
    grid-template-columns:1fr; align-items:center;
  }
  .h-title{
    margin:0; font-family:'Poppins',sans-serif; font-weight:900; color:#141922;
    font-size:clamp(1.4rem,3.4vw,2.3rem);
  }
  .h-sub{margin:6px 0 8px; color:#7a3e53; font-weight:800; font-size:clamp(1rem,2vw,1.15rem)}
  .ticker{
    height:54px; border-radius:14px; border:1px solid #ffe1ef; background:linear-gradient(90deg,#fff,#fff0);
    position:relative; overflow:hidden; box-shadow:var(--shadow);
  }
  .ticker-track{
    position:absolute; inset:0; display:flex; align-items:center; gap:36px; padding:0 14px;
    animation:scroll 22s linear infinite; white-space:nowrap; font-weight:900; color:#7a3e53;
  }
  .pill{
    display:inline-flex; align-items:center; gap:8px; padding:8px 14px; border-radius:999px;
    border:1px solid #ffd3e4; background:#fff; font-size:.98rem;
  }
  @keyframes scroll{ from{transform:translateX(0)} to{transform:translateX(-50%)} }
  .wave{display:block;width:100%;height:auto}

  /* ===== Cards ===== */
  .section{max-width:1200px; margin:0 auto; padding:20px var(--space)}
  .sec-title h2{ margin:0; font-family:'Poppins',sans-serif; font-weight:900; color:#141922; font-size:clamp(1.2rem,2.2vw,1.7rem) }
  .grid{ display:grid; gap:clamp(12px,2vw,18px); margin-top:14px; grid-template-columns:repeat(1,minmax(0,1fr)); }
  @media (min-width:760px){ .grid{grid-template-columns:repeat(2,1fr)} }
  @media (min-width:1060px){ .grid{grid-template-columns:repeat(3,1fr)} }
  @media (min-width:1360px){ .grid{grid-template-columns:repeat(4,1fr)} }
  .card{ background:#fff; border:1px solid #ffe1ef; border-radius:18px; box-shadow:var(--shadow); display:grid; grid-template-rows:auto 1fr auto; overflow:hidden; }
  .thumb{display:grid; place-items:center; height:170px; border-bottom:1px solid #ffe1ef}
  .thumb span{font-size:48px}
  .card-body{padding:14px}
  .card h3{margin:0 0 6px; font-size:clamp(1.06rem,1.4vw,1.25rem); color:#141922; font-weight:900}
  .card p{margin:0; color:#61708d; font-size:clamp(.95rem,1vw,1.05rem)}
  .tags{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
  .tag{font-size:.85rem; padding:6px 10px; border-radius:999px; background:#fff; border:1px solid #ffd3e4; color:#7a3e53; font-weight:800}
  .card-actions{display:flex; gap:10px; padding:12px; border-top:1px solid #ffe1ef; background:#fff}
  .btn{flex:1; border:none; border-radius:12px; padding:14px 16px; font-weight:900; cursor:pointer; min-height:52px}
  .btn-play{background:linear-gradient(90deg,var(--pink-400),var(--pink-500)); color:#fff}
  .btn-rank{background:#fff; border:1px solid #ffd3e4; color:#273043}

  /* ===== Modais ===== */
  dialog::backdrop{background:rgba(0,0,0,.45)}
  dialog{border:none; border-radius:20px; padding:0; overflow:hidden; box-shadow:0 40px 110px rgba(0,0,0,.25); width:min(1100px,96vw)}
  .modal-header{
    display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:10px;
    padding:10px 12px; background:var(--pink-100); border-bottom:1px solid #ffd3e4
  }
  .modal-title{font-weight:900; color:#141922; justify-self:center}
  .icon-btn{background:#fff; border:1px solid #ffd3e4; border-radius:10px; padding:8px 12px; cursor:pointer; font-weight:900; min-height:44px}
  .modal-body{background:#f8fbff; padding:0}
  dialog.fullscreen{width:100vw; height:100dvh; max-width:none; max-height:none; border-radius:0;}
  dialog.fullscreen .modal-body{ height:calc(100dvh - 52px); display:grid; place-items:center; padding:clamp(10px,2vw,24px); }

  /* ===== Jogo ===== */
  #game-container{ width:clamp(320px, 70vw, 980px); max-width:96vw; background:#fff; border:1px solid #eef2f5; border-radius:14px; box-shadow:0 6px 12px rgba(0,0,0,.06); padding:clamp(16px,2vw,26px); display:flex; flex-direction:column; gap:12px; text-align:center; }
  @media (max-width:600px){ #game-container{ width:min(540px, 96vw); border-radius:12px; } }
  .screen{display:flex; flex-direction:column; align-items:center; gap:12px; width:100%}
  .options{display:flex; flex-direction:column; gap:12px; width:min(760px,100%)}
  .option-btn{ background:#eef2ff; color:#1f2a3a; border:none; border-radius:12px; padding:16px; font-weight:900; cursor:pointer; font-size:clamp(1rem,1.2vw,1.2rem); min-height:56px; transition:transform .05s ease; }
  .option-btn:active{transform:scale(.99)}
  .btn-start{background:linear-gradient(90deg,var(--pink-400),var(--pink-500)); color:#fff; box-shadow:0 10px 24px rgba(255,92,150,.25)}
  .btn-level-f{background:var(--green); color:#fff}
  .btn-level-m{background:var(--yellow); color:#fff}
  .btn-level-d{background:var(--red); color:#fff}
  .btn-green{background-color:var(--green); color:#fff}
  .btn-red{background-color:var(--red); color:#fff}
  #player-input{width:min(420px,100%); padding:14px 16px; border:1px solid #e6e6e6; border-radius:12px; text-align:center; font-size:1.05rem}
  #level-display{font-weight:900}
  .rules{ max-width:720px; font-size:.95rem; color:#6d3b4f; background:#fff5fa; border:1px solid #ffd6e6; padding:10px 12px; border-radius:12px; }
  .hidden{display:none}

  /* ===== Ranking – chips alinhados ===== */
  .filter-bar{display:flex; gap:8px; flex-wrap:wrap; align-items:center; padding:10px 12px; background:#fff; border-bottom:1px solid #f1e2ea}
  .filter-bar .chip{padding:10px 16px; border-radius:999px; background:#ffe9f2; border:1px solid #ffd0e1; font-weight:900; color:#7a3e53; cursor:pointer}
  .filter-bar .chip[aria-pressed="true"]{background:var(--pink-400); color:#fff; border-color:var(--pink-500)}
  .rank-wrap{padding:14px}
  .rank-list{list-style:none; padding:0; margin:0; display:grid; gap:10px}
  .rank-item{display:flex; justify-content:space-between; align-items:center; background:#fff; border:1px solid #f1e2ea; border-radius:12px; padding:12px 14px}

  /* ===== Footer ===== */
  footer{background:#fff; border-top:1px solid #ffe1ef; margin-top:20px}
  .foot{max-width:1200px; margin:0 auto; padding:18px var(--space); text-align:center; color:#61708d}
  .foot small{display:block; color:#7a3e53}
</style>
</head>
<body>

<!-- ===== Topo ===== -->
<div class="topbar">
  <div class="nav">
    <div class="brand">
      <img src="imagens/48b51d5a-9d87-436d-8617-8a9801c054ac.png" alt="Logo Profª Julia Maria" />
    </div>

    <div class="search" role="search" aria-label="Busca e filtros">
      <span class="glass">🔎</span>
      <input id="q" type="search" placeholder="Buscar jogo..." oninput="applyFilters()" />
    </div>

    <button class="menu-btn" id="open-drawer" aria-label="Abrir filtros">☰</button>
  </div>
</div>

<!-- Drawer mobile de filtros -->
<div class="overlay" id="overlay" onclick="closeDrawer()"></div>
<div class="drawer" id="drawer" aria-modal="true" role="dialog" aria-label="Filtros">
  <div class="drag"></div>
  <h3>Filtros</h3>
  <div class="row">
    <select id="m-filter-subj" class="select" onchange="syncFiltersAndApply()">
      <option value="">Matéria</option>
      <option>Matemática</option>
      <option>Ciências da Natureza</option>
      <option>Ciências Humanas</option>
      <option>Língua Portuguesa</option>
    </select>
    <select id="m-filter-year" class="select" onchange="syncFiltersAndApply()">
      <option value="">Ano</option>
      <option>5º ano</option>
    </select>
  </div>
</div>

<!-- ===== Hero ===== -->
<section class="hero">
  <div class="wrap">
    <div>
      <h1 class="h-title">Aprender brincando: jogos curtos, objetivos e divertidos</h1>
      <p class="h-sub">Conteúdos pedagógicos</p>

      <div class="ticker" aria-hidden="true">
        <div class="ticker-track">
          <span class="pill">📏 Unidades</span>
          <span class="pill">🍕 Frações</span>
          <span class="pill">➕ Naturais</span>
          <span class="pill">🔢 Posicional</span>
          <span class="pill">📐 Área & Perímetro</span>
          <span class="pill">⏰ Tempo</span>
          <span class="pill">📏 Unidades</span>
          <span class="pill">🍕 Frações</span>
          <span class="pill">➕ Naturais</span>
          <span class="pill">🔢 Posicional</span>
          <span class="pill">📐 Área & Perímetro</span>
          <span class="pill">⏰ Tempo</span>
        </div>
      </div>
    </div>
  </div>
  <svg class="wave" viewBox="0 0 1440 90" preserveAspectRatio="none" aria-hidden="true">
    <path fill="#ffffff" d="M0,64L60,58.7C120,53,240,43,360,48C480,53,600,75,720,85.3C840,96,960,96,1080,85.3C1200,75,1320,53,1380,42.7L1440,32L1440,0L0,0Z"></path>
  </svg>
</section>

<!-- ===== Jogos ===== -->
<section class="section" id="games">
  <div class="sec-title"><h2>Jogos em destaque</h2></div>
  <div class="grid" id="games-grid"></div>
</section>

<!-- ===== Modal do Jogo ===== -->
<dialog id="game-modal" aria-label="Jogo" class="fullscreen">
  <div class="modal-header">
    <button class="icon-btn" onclick="backFromGame()">← Voltar</button>
    <div class="modal-title" id="modal-title">Jogo</div>
    <span></span>
  </div>
  <div class="modal-body">
    <div id="game-container">
      <div id="start-screen" class="screen">
        <h3 id="game-name" style="margin:0;color:#7a3e53;font-weight:900">Jogo</h3>
        <input type="text" id="player-input" placeholder="Seu nome" autocomplete="name" />
        <div class="rules">
          <strong>Como funciona:</strong> escolha um nível. Cada acerto soma pontos e cada erro desconta pontos.
          <br/>Fácil: +3 / −1 • Médio: +5 / −2 • Difícil: +10 / −3.
        </div>
        <div class="options" role="group" aria-label="Níveis">
          <button class="option-btn btn-level-f" id="btn-facil"   onclick="selectLevel('facil')"   disabled>Fácil</button>
          <button class="option-btn btn-level-m" id="btn-medio"   onclick="selectLevel('medio')"   disabled>Médio</button>
          <button class="option-btn btn-level-d" id="btn-dificil" onclick="selectLevel('dificil')" disabled>Difícil</button>
        </div>
        <button id="start-btn" class="option-btn btn-start" onclick="startSelectedGame()" disabled>Começar</button>
      </div>

      <div id="game-screen" class="screen hidden">
        <p id="level-display" style="font-weight:900;"></p>
        <div id="question-box"><p id="question-text" style="font-size:1.12rem"></p></div>
        <div id="options-container" class="options">
          <button id="option-a" class="option-btn" onclick="checkAnswer('a')"></button>
          <button id="option-b" class="option-btn" onclick="checkAnswer('b')"></button>
          <button id="option-c" class="option-btn" onclick="checkAnswer('c')"></button>
        </div>
        <div id="feedback" class="hidden"></div>
        <p id="score-display-game">Pontuação: 0</p>
        <button id="next-btn" class="option-btn" onclick="nextQuestion()">Próxima</button>
      </div>
    </div>
  </div>
</dialog>

<!-- ===== Modal de Ranking ===== -->
<dialog id="ranking-modal" aria-label="Ranking">
  <div class="modal-header">
    <button class="icon-btn" onclick="closeRanking()">← Voltar</button>
    <div class="modal-title" id="ranking-title">Ranking de Hoje</div>
    <span></span>
  </div>
  <div class="modal-body">
    <div class="filter-bar">
      <strong id="rank-game-name"></strong>
      <div style="flex:1"></div>
      <button class="chip" data-level="facil"  aria-pressed="true"  onclick="setRankingLevel('facil')">Fácil</button>
      <button class="chip" data-level="medio"  aria-pressed="false" onclick="setRankingLevel('medio')">Médio</button>
      <button class="chip" data-level="dificil" aria-pressed="false" onclick="setRankingLevel('dificil')">Difícil</button>
    </div>
    <div class="rank-wrap">
      <ul class="rank-list" id="rank-list"></ul>
      <p class="rank-empty hidden" id="rank-empty">Nenhum recorde hoje! Seja o primeiro.</p>
      <p style="margin-top:8px;opacity:.8"><small>Ranking diário — <span id="rank-date"></span></small></p>
    </div>
  </div>
</dialog>

<footer>
  <div class="foot">
    © <span id="year"></span> Profª Julia Maria — Repositório de Jogos
    <small>Plataforma otimizada para tablets, celulares e desktops.</small>
  </div>
</footer>

<script>
  /* ===== Drawer mobile ===== */
  const drawer = document.getElementById('drawer');
  const overlay = document.getElementById('overlay');
  const openBtn = document.getElementById('open-drawer');

  function openDrawer(){
    drawer.classList.add('open'); overlay.classList.add('show');
    document.documentElement.style.overflow='hidden';
    document.body.style.overflow='hidden';
  }
  function closeDrawer(){
    drawer.classList.remove('open'); overlay.classList.remove('show');
    document.documentElement.style.overflow=''; document.body.style.overflow='';
  }
  openBtn.addEventListener('click', openDrawer);

  function syncFiltersAndApply(){ applyFilters(); } // (mantido simplificado)

  /* ===== Cards ===== */
  const gamesMeta = [
    { key:'unidades', title:'Unidades de Medida', desc:'Grandezas, conversões e instrumentos.', emoji:'📏', subj:'Matemática', year:'5º ano' },
    { key:'fracoes', title:'Frações: equivalência e comparação', desc:'Comparar, ordenar e reconhecer equivalências.', emoji:'🍕', subj:'Matemática', year:'5º ano' },
    { key:'naturais', title:'Operações com Números Naturais', desc:'Adição, subtração, multiplicação e divisão.', emoji:'➕', subj:'Matemática', year:'5º ano' },
    { key:'posicional', title:'Valor Posicional e Arredondamento', desc:'Leitura, comparação e arredondamento.', emoji:'🔢', subj:'Matemática', year:'5º ano' },
    { key:'area_perimetro', title:'Perímetro e Área', desc:'Retângulos, quadrados e desafios.', emoji:'📐', subj:'Matemática', year:'5º ano' },
    { key:'tempo', title:'Medidas de Tempo', desc:'Leitura de horas e tempo decorrido.', emoji:'⏰', subj:'Matemática', year:'5º ano' },
  ];
  function renderCards(){
    const grid=document.getElementById('games-grid'); grid.innerHTML='';
    gamesMeta.forEach(g=>{
      const el=document.createElement('article'); el.className='card';
      el.dataset.subj=g.subj; el.dataset.year=g.year;
      el.dataset.search=(g.title+' '+g.desc+' '+g.subj+' '+g.year).toLowerCase();
      el.innerHTML=`
        <div class="thumb"><span>${g.emoji}</span></div>
        <div class="card-body">
          <h3>${g.title}</h3>
          <p>${g.desc}</p>
          <div class="tags">
            <span class="tag">${g.year}</span>
            <span class="tag">${g.subj}</span>
          </div>
        </div>
        <div class="card-actions">
          <button class="btn btn-play" onclick="openGame('${g.key}', true)">Jogar</button>
          <button class="btn btn-rank" onclick="openRanking('${g.key}')">Ranking</button>
        </div>`;
      grid.appendChild(el);
    });
  }

  function applyFilters(){
    const q=document.getElementById('q').value.toLowerCase().trim();
    document.querySelectorAll('.card').forEach(card=>{
      const text=card.dataset.search;
      const okQ=!q || text.includes(q);
      card.style.display=okQ?'':'none';
    });
  }

  /* ===== Banco de questões (exemplo) ===== */
  const gamesQuestions = {
    unidades: {
      facil: [
        { q:'O que mede melhor a altura de uma pessoa?', a:'Metros', b:'Litros', c:'Quilos', correct:'a' },
        { q:'1 L = ?', a:'100 mL', b:'1.000 mL', c:'10.000 mL', correct:'b' },
        { q:'Régua de 30 cm tem…', a:'30 mm', b:'300 mm', c:'3.000 mm', correct:'b' },
        { q:'Temperatura do corpo em…', a:'Graus Celsius', b:'Quilômetros', c:'Litros', correct:'a' }
      ]
    }
  };

  /* ===== Estado & Jogo ===== */
  let selectedGameKey=null, selectedLevel='', questionIndex=0, score=0, answered=false, playerName='';
  const modal=document.getElementById('game-modal');
  const modalTitle=document.getElementById('modal-title');
  const gameNameEl=document.getElementById('game-name');
  const playerInput=document.getElementById('player-input');
  const startBtn=document.getElementById('start-btn');
  const startScreen=document.getElementById('start-screen');
  const gameScreen=document.getElementById('game-screen');
  const levelDisplay=document.getElementById('level-display');
  const questionText=document.getElementById('question-text');
  const optionA=document.getElementById('option-a');
  const optionB=document.getElementById('option-b');
  const optionC=document.getElementById('option-c');
  const feedbackEl=document.getElementById('feedback');
  const scoreDisplayGame=document.getElementById('score-display-game');

  const levelPoints={facil:{correct:3,wrong:1}, medio:{correct:5,wrong:2}, dificil:{correct:10,wrong:3}};

  function openGame(key, autoFS=false){
    selectedGameKey=key; selectedLevel='';
    const meta=gamesMeta.find(g=>g.key===key);
    modalTitle.textContent = meta.title;
    gameNameEl.textContent = meta.title;
    resetGameState();
    if(!modal.open) modal.showModal();
    modal.classList.add('fullscreen');
    document.body.classList.add('immersive');
    if (autoFS) modal.requestFullscreen?.().catch(()=>{});
  }
  function backFromGame(){
    if(document.fullscreenElement) document.exitFullscreen?.();
    document.body.classList.remove('immersive');
    if(modal.open) modal.close();
  }

  function resetGameState(){
    questionIndex=0; score=0; answered=false; playerName=''; selectedLevel='';
    playerInput.value=''; startBtn.disabled=true;
    ['btn-facil','btn-medio','btn-dificil'].forEach(id=>{
      const el=document.getElementById(id); el.disabled=true; el.style.boxShadow='none';
    });
    startScreen.classList.remove('hidden'); gameScreen.classList.add('hidden');
  }
  document.addEventListener('input', e=>{
    if (e.target===playerInput){
      const ok=playerInput.value.trim().length>0;
      ['btn-facil','btn-medio','btn-dificil'].forEach(id=>document.getElementById(id).disabled=!ok);
      startBtn.disabled=!ok || !selectedLevel;
    }
  });
  function selectLevel(lvl){
    selectedLevel=lvl;
    const map={facil:'btn-facil',medio:'btn-medio',dificil:'btn-dificil'};
    ['btn-facil','btn-medio','btn-dificil'].forEach(id=>document.getElementById(id).style.boxShadow='none');
    document.getElementById(map[lvl]).style.boxShadow='0 0 0 3px rgba(0,0,0,.07), 0 0 0 4px var(--blue)';
    startBtn.disabled=!playerInput.value.trim().length;
  }
  function startSelectedGame(){
    playerName=playerInput.value.trim();
    if(!playerName){ alert('Digite seu nome para começar.'); return; }
    if(!selectedLevel){ alert('Escolha um nível.'); return; }
    startScreen.classList.add('hidden'); gameScreen.classList.remove('hidden');
    levelDisplay.textContent=`Nível: ${selectedLevel.charAt(0).toUpperCase()+selectedLevel.slice(1)}`;
    scoreDisplayGame.textContent='Pontuação: 0';
    showQuestion();
  }
  function showQuestion(){
    answered=false; feedbackEl.classList.add('hidden'); document.getElementById('next-btn').classList.add('hidden');
    const current=(gamesQuestions[selectedGameKey]?.[selectedLevel] || [{q:'Em breve 🙂',a:'—',b:'—',c:'—',correct:'a'}])[questionIndex] || {q:'Fim!',a:'',b:'',c:'',correct:'a'};
    questionText.textContent=current.q;
    optionA.textContent=`a) ${current.a}`; optionB.textContent=`b) ${current.b}`; optionC.textContent=`c) ${current.c}`;
    [optionA,optionB,optionC].forEach(btn=>btn.classList.remove('btn-green','btn-red'));
  }
  function checkAnswer(answer){
    if(answered) return; answered=true;
    const current=(gamesQuestions[selectedGameKey]?.[selectedLevel] || [])[questionIndex];
    const pts=levelPoints[selectedLevel]||levelPoints.facil;
    if(current && answer===current.correct){
      score+=pts.correct; feedbackEl.textContent=`Correto! (+${pts.correct})`; feedbackEl.style.color='green';
      document.getElementById(`option-${answer}`).classList.add('btn-green');
    }else{
      score-=pts.wrong; feedbackEl.textContent=`Ops! (-${pts.wrong})`; feedbackEl.style.color='#b00020';
      document.getElementById(`option-${answer}`).classList.add('btn-red');
    }
    scoreDisplayGame.textContent=`Pontuação: ${score}`;
    feedbackEl.classList.remove('hidden'); document.getElementById('next-btn').classList.remove('hidden');
  }
  function nextQuestion(){ questionIndex++; showQuestion(); }

  /* ===== Ranking local (fallback) ===== */
  function todayKey(){ return new Date().toISOString().slice(0,10); }
  function rkKey(game,level){ return `ranking_${game}_${level}_${todayKey()}`; }
  function loadRankingLocal(game,level){ try{ return (JSON.parse(localStorage.getItem(rkKey(game,level)))||[]).sort((a,b)=>b.score-a.score); }catch{return [];} }
  function saveRankingLocal(game,level,arr){ try{ localStorage.setItem(rkKey(game,level), JSON.stringify(arr)); }catch{} }
  function addScoreLocal(game,level,name,finalScore){
    let ranking=loadRankingLocal(game,level);
    ranking.push({name,score:finalScore});
    ranking.sort((a,b)=>b.score-a.score);
    saveRankingLocal(game,level,ranking.slice(0,10));
  }

  /* ===== Modal Ranking ===== */
  const rmodal=document.getElementById('ranking-modal');
  const rankTitle=document.getElementById('ranking-title');
  const rankGameName=document.getElementById('rank-game-name');
  const rankList=document.getElementById('rank-list');
  const rankEmpty=document.getElementById('rank-empty');
  const rankDate=document.getElementById('rank-date');
  let rankingGameKey=null, rankingLevel='facil';
  window.unsubscribeRanking=null;

  function openRanking(gameKey){
    rankingGameKey=gameKey; rankingLevel='facil';
    rankTitle.textContent='Ranking de Hoje'; rankGameName.textContent=gamesMeta.find(g=>g.key===gameKey).title;
    document.querySelectorAll('#ranking-modal .chip').forEach(c=>c.setAttribute('aria-pressed','false'));
    document.querySelector('#ranking-modal .chip[data-level="facil"]').setAttribute('aria-pressed','true');
    if(!rmodal.open) rmodal.showModal();
    startRealtimeRanking();
  }
  function closeRanking(){
    if (window.unsubscribeRanking) { window.unsubscribeRanking(); window.unsubscribeRanking=null; }
    if(rmodal.open) rmodal.close();
  }
  function setRankingLevel(lvl){
    rankingLevel=lvl;
    document.querySelectorAll('#ranking-modal .chip').forEach(c=>c.setAttribute('aria-pressed','false'));
    document.querySelector(`#ranking-modal .chip[data-level="${lvl}"]`).setAttribute('aria-pressed','true');
    startRealtimeRanking();
  }
  function renderRankingList(arr){
    rankList.innerHTML=''; rankDate.textContent=todayKey();
    if(!arr || !arr.length){ rankEmpty.classList.remove('hidden'); return; }
    rankEmpty.classList.add('hidden');
    arr.forEach((e,i)=>{
      const li=document.createElement('li'); li.className='rank-item';
      li.innerHTML=`<strong>${i+1}. ${e.name}</strong><span>${e.score} pts</span>`;
      rankList.appendChild(li);
    });
  }

  /* ===== Init ===== */
  function init(){
    renderCards(); applyFilters();
    document.getElementById('year').textContent=new Date().getFullYear();
  }
  document.addEventListener('DOMContentLoaded', init);
</script>

<!-- ===== Firestore (opcional para ranking online) ===== -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp,
           query, where, orderBy, limit, onSnapshot } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

  /* COLE A SUA CONFIG DO FIREBASE AQUI
  const firebaseConfig = {
    apiKey: "…",
    authDomain: "…",
    projectId: "…",
    storageBucket: "…",
    messagingSenderId: "…",
    appId: "…"
  };
  */
  let app=null, db=null;
  try{
    app = initializeApp(firebaseConfig);
    db = getFirestore(app);
  }catch(e){
    console.warn('Firebase não configurado. Ranking usa fallback local.', e?.message||e);
  }

  const todayKey = () => new Date().toISOString().slice(0,10);

  async function addScoreOnline(game, level, name, finalScore){
    if(!db) throw new Error('Sem Firebase');
    await addDoc(collection(db,"scores"), {
      game, level, name, score: finalScore,
      date: todayKey(),
      createdAt: serverTimestamp()
    });
  }

  window.addScoreToRanking = async function(game, level, name, finalScore){
    try{ await addScoreOnline(game, level, name, finalScore); }
    catch(e){ console.warn('Salvar online falhou, usando local.', e?.message||e); addScoreLocal(game, level, name, finalScore); }
  }

  window.startRealtimeRanking = function(){
    if (window.unsubscribeRanking) { window.unsubscribeRanking(); window.unsubscribeRanking=null; }
    const game = window.rankingGameKey, level = window.rankingLevel;

    if(!db){ const arr = loadRankingLocal(game, level); renderRankingList(arr); return; }

    const q = query(
      collection(db, "scores"),
      where("date","==", todayKey()),
      where("game","==", game),
      where("level","==", level),
      orderBy("score","desc"),
      limit(10)
    );
    window.unsubscribeRanking = onSnapshot(q, (snap)=>{
      const arr=[]; snap.forEach(d=>arr.push(d.data()));
      renderRankingList(arr);
    }, (err)=>{
      console.warn('Snapshot erro, voltando pro local:', err?.message||err);
      const arr = loadRankingLocal(game, level); renderRankingList(arr);
    });
  }
</script>
</body>
</html>
